## Cloud Formation Script

### EC2 instnace User data


```
"UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "#!/bin/bash -xe\n",
                                "sudo su","\n",
                                "sudo yum update -y","\n",
                                "sudo yum install git -y","\n",
                                "sudo git clone https://github.com/getsentry/onpremise.git","\n",
                                "sudo yum install docker -y","\n",
                                "sudo service docker start","\n",
                                "sudo usermod -a -G docker ec2-user","\n",
                                "yum update -y aws-cfn-bootstrap\n",
                                "yum update -y aws-cli\n",
                                "sudo curl -L \"https://github.com/docker/compose/releases/download/1.23.1/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n",
                                "sudo chmod +x /usr/local/bin/docker-compose\n",
								                "sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose","\n",
								                "cd /onpremise","\n",
                                "docker volume create --name=sentry-data && docker volume create --name=sentry-postgres","\n",
								                "cd /onpremise","\n",
                                "cp -n .env.example .env","\n",
                                "sudo docker-compose build","\n",
                                "sudo docker-compose run --rm web config generate-secret-key > generate_key_output.txt\n",
                                "KEY=$(tail -n 1 generate_key_output.txt)\n",
                                "cat /dev/null > .env\n",
                                "comment=\"#Find the below key generated by docker-compose\"\n",
                                "echo $comment > .env\n",
                                "sed -i \"1i SENTRY_SECRET_KEY=${KEY}\" .env\n",
				                        "yes n | sudo docker-compose run --rm web upgrade","\n",
                                "sudo docker-compose up -d",
                                "\n",
                                
